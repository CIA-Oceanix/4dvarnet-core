12
###Â RUN DATE 2012-10-22 to 2012-10-29 ###
### RUN SIMU 0 to 5 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-22'
    - '2012-10-29'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-22'
    - '2012-10-29'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:49:39,724][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:49:40,458][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:49:40,470][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:49:40,482][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-10-22"', 'datamodule.test_slices.0._args_.1="2012-10-29"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
### RUN SIMU 5 to 10 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-22'
    - '2012-10-29'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-22'
    - '2012-10-29'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:49:50,753][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:49:51,324][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:49:51,338][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:49:51,352][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-10-22"', 'datamodule.test_slices.0._args_.1="2012-10-29"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 209, in _acquire_with_cache_info
    file = self._cache[self._key]
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/lru_cache.py", line 55, in __getitem__
    value = self._cache[key]
KeyError: [<class 'netCDF4._netCDF4.Dataset'>, ('/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc',), 'r', (('clobber', True), ('diskless', False), ('format', 'NETCDF4'), ('persist', False)), '3fa12b52-b059-42d8-b73b-b55effdaae88']

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<stdin>", line 4, in <module>
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/api.py", line 539, in open_dataset
    backend_ds = backend.open_dataset(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 572, in open_dataset
    store = NetCDF4DataStore.open(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 376, in open
    return cls(manager, group=group, mode=mode, lock=lock, autoclose=autoclose)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 323, in __init__
    self.format = self.ds.data_model
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 385, in ds
    return self._acquire()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 379, in _acquire
    with self._manager.acquire_context(needs_lock) as root:
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/contextlib.py", line 135, in __enter__
    return next(self.gen)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 197, in acquire_context
    file, cached = self._acquire_with_cache_info(needs_lock)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 215, in _acquire_with_cache_info
    file = self._opener(*self._args, **kwargs)
  File "src/netCDF4/_netCDF4.pyx", line 2449, in netCDF4._netCDF4.Dataset.__init__
  File "src/netCDF4/_netCDF4.pyx", line 2012, in netCDF4._netCDF4._ensure_nc_success
FileNotFoundError: [Errno 2] No such file or directory: '/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc'
###Â RUN DATE 2012-10-26 to 2012-11-02 ###
### RUN SIMU 0 to 5 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-26'
    - '2012-11-02'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-26'
    - '2012-11-02'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:50:03,036][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:50:03,684][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:50:03,696][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:50:03,707][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-10-26"', 'datamodule.test_slices.0._args_.1="2012-11-02"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
### RUN SIMU 5 to 10 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-26'
    - '2012-11-02'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-26'
    - '2012-11-02'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:50:14,551][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:50:15,143][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:50:15,158][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:50:15,173][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-10-26"', 'datamodule.test_slices.0._args_.1="2012-11-02"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 209, in _acquire_with_cache_info
    file = self._cache[self._key]
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/lru_cache.py", line 55, in __getitem__
    value = self._cache[key]
KeyError: [<class 'netCDF4._netCDF4.Dataset'>, ('/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc',), 'r', (('clobber', True), ('diskless', False), ('format', 'NETCDF4'), ('persist', False)), 'f4fd4828-6fc1-48b8-b99f-beb24cba0e20']

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<stdin>", line 4, in <module>
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/api.py", line 539, in open_dataset
    backend_ds = backend.open_dataset(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 572, in open_dataset
    store = NetCDF4DataStore.open(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 376, in open
    return cls(manager, group=group, mode=mode, lock=lock, autoclose=autoclose)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 323, in __init__
    self.format = self.ds.data_model
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 385, in ds
    return self._acquire()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 379, in _acquire
    with self._manager.acquire_context(needs_lock) as root:
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/contextlib.py", line 135, in __enter__
    return next(self.gen)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 197, in acquire_context
    file, cached = self._acquire_with_cache_info(needs_lock)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 215, in _acquire_with_cache_info
    file = self._opener(*self._args, **kwargs)
  File "src/netCDF4/_netCDF4.pyx", line 2449, in netCDF4._netCDF4.Dataset.__init__
  File "src/netCDF4/_netCDF4.pyx", line 2012, in netCDF4._netCDF4._ensure_nc_success
FileNotFoundError: [Errno 2] No such file or directory: '/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc'
###Â RUN DATE 2012-10-30 to 2012-11-06 ###
### RUN SIMU 0 to 5 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-30'
    - '2012-11-06'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-30'
    - '2012-11-06'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:50:27,085][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:50:27,622][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:50:27,634][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:50:27,645][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-10-30"', 'datamodule.test_slices.0._args_.1="2012-11-06"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
### RUN SIMU 5 to 10 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-30'
    - '2012-11-06'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-30'
    - '2012-11-06'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:50:37,678][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:50:38,229][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:50:38,241][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:50:38,257][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-10-30"', 'datamodule.test_slices.0._args_.1="2012-11-06"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 209, in _acquire_with_cache_info
    file = self._cache[self._key]
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/lru_cache.py", line 55, in __getitem__
    value = self._cache[key]
KeyError: [<class 'netCDF4._netCDF4.Dataset'>, ('/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc',), 'r', (('clobber', True), ('diskless', False), ('format', 'NETCDF4'), ('persist', False)), '8b431d3b-d4af-48a6-86c4-9930d0668fdf']

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<stdin>", line 4, in <module>
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/api.py", line 539, in open_dataset
    backend_ds = backend.open_dataset(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 572, in open_dataset
    store = NetCDF4DataStore.open(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 376, in open
    return cls(manager, group=group, mode=mode, lock=lock, autoclose=autoclose)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 323, in __init__
    self.format = self.ds.data_model
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 385, in ds
    return self._acquire()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 379, in _acquire
    with self._manager.acquire_context(needs_lock) as root:
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/contextlib.py", line 135, in __enter__
    return next(self.gen)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 197, in acquire_context
    file, cached = self._acquire_with_cache_info(needs_lock)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 215, in _acquire_with_cache_info
    file = self._opener(*self._args, **kwargs)
  File "src/netCDF4/_netCDF4.pyx", line 2449, in netCDF4._netCDF4.Dataset.__init__
  File "src/netCDF4/_netCDF4.pyx", line 2012, in netCDF4._netCDF4._ensure_nc_success
FileNotFoundError: [Errno 2] No such file or directory: '/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc'
###Â RUN DATE 2012-11-03 to 2012-11-10 ###
### RUN SIMU 0 to 5 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-03'
    - '2012-11-10'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-03'
    - '2012-11-10'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:50:50,689][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:50:51,320][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:50:51,331][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:50:51,342][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-11-03"', 'datamodule.test_slices.0._args_.1="2012-11-10"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
### RUN SIMU 5 to 10 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-03'
    - '2012-11-10'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-03'
    - '2012-11-10'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:51:01,572][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:51:02,215][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:51:02,227][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:51:02,238][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-11-03"', 'datamodule.test_slices.0._args_.1="2012-11-10"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 209, in _acquire_with_cache_info
    file = self._cache[self._key]
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/lru_cache.py", line 55, in __getitem__
    value = self._cache[key]
KeyError: [<class 'netCDF4._netCDF4.Dataset'>, ('/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc',), 'r', (('clobber', True), ('diskless', False), ('format', 'NETCDF4'), ('persist', False)), 'f5c7743a-f839-49b2-964d-03eb6442c874']

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<stdin>", line 4, in <module>
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/api.py", line 539, in open_dataset
    backend_ds = backend.open_dataset(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 572, in open_dataset
    store = NetCDF4DataStore.open(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 376, in open
    return cls(manager, group=group, mode=mode, lock=lock, autoclose=autoclose)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 323, in __init__
    self.format = self.ds.data_model
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 385, in ds
    return self._acquire()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 379, in _acquire
    with self._manager.acquire_context(needs_lock) as root:
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/contextlib.py", line 135, in __enter__
    return next(self.gen)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 197, in acquire_context
    file, cached = self._acquire_with_cache_info(needs_lock)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 215, in _acquire_with_cache_info
    file = self._opener(*self._args, **kwargs)
  File "src/netCDF4/_netCDF4.pyx", line 2449, in netCDF4._netCDF4.Dataset.__init__
  File "src/netCDF4/_netCDF4.pyx", line 2012, in netCDF4._netCDF4._ensure_nc_success
FileNotFoundError: [Errno 2] No such file or directory: '/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc'
###Â RUN DATE 2012-11-07 to 2012-11-14 ###
### RUN SIMU 0 to 5 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-07'
    - '2012-11-14'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-07'
    - '2012-11-14'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:51:13,691][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:51:14,269][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:51:14,283][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:51:14,297][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-11-07"', 'datamodule.test_slices.0._args_.1="2012-11-14"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
### RUN SIMU 5 to 10 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-07'
    - '2012-11-14'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-07'
    - '2012-11-14'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:51:24,786][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:51:25,367][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:51:25,380][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:51:25,391][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-11-07"', 'datamodule.test_slices.0._args_.1="2012-11-14"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 209, in _acquire_with_cache_info
    file = self._cache[self._key]
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/lru_cache.py", line 55, in __getitem__
    value = self._cache[key]
KeyError: [<class 'netCDF4._netCDF4.Dataset'>, ('/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc',), 'r', (('clobber', True), ('diskless', False), ('format', 'NETCDF4'), ('persist', False)), 'ad52c398-47f0-4fad-b301-65991285d514']

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<stdin>", line 4, in <module>
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/api.py", line 539, in open_dataset
    backend_ds = backend.open_dataset(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 572, in open_dataset
    store = NetCDF4DataStore.open(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 376, in open
    return cls(manager, group=group, mode=mode, lock=lock, autoclose=autoclose)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 323, in __init__
    self.format = self.ds.data_model
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 385, in ds
    return self._acquire()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 379, in _acquire
    with self._manager.acquire_context(needs_lock) as root:
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/contextlib.py", line 135, in __enter__
    return next(self.gen)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 197, in acquire_context
    file, cached = self._acquire_with_cache_info(needs_lock)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 215, in _acquire_with_cache_info
    file = self._opener(*self._args, **kwargs)
  File "src/netCDF4/_netCDF4.pyx", line 2449, in netCDF4._netCDF4.Dataset.__init__
  File "src/netCDF4/_netCDF4.pyx", line 2012, in netCDF4._netCDF4._ensure_nc_success
FileNotFoundError: [Errno 2] No such file or directory: '/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc'
###Â RUN DATE 2012-11-11 to 2012-11-18 ###
### RUN SIMU 0 to 5 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-11'
    - '2012-11-18'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-11'
    - '2012-11-18'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:51:37,089][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:51:37,709][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:51:37,721][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:51:37,732][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-11-11"', 'datamodule.test_slices.0._args_.1="2012-11-18"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
### RUN SIMU 5 to 10 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-11'
    - '2012-11-18'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-11'
    - '2012-11-18'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:51:48,437][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:51:49,058][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:51:49,069][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:51:49,081][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-11-11"', 'datamodule.test_slices.0._args_.1="2012-11-18"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 209, in _acquire_with_cache_info
    file = self._cache[self._key]
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/lru_cache.py", line 55, in __getitem__
    value = self._cache[key]
KeyError: [<class 'netCDF4._netCDF4.Dataset'>, ('/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc',), 'r', (('clobber', True), ('diskless', False), ('format', 'NETCDF4'), ('persist', False)), '780537e9-efec-4a3c-96c5-16f6103b8760']

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<stdin>", line 4, in <module>
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/api.py", line 539, in open_dataset
    backend_ds = backend.open_dataset(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 572, in open_dataset
    store = NetCDF4DataStore.open(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 376, in open
    return cls(manager, group=group, mode=mode, lock=lock, autoclose=autoclose)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 323, in __init__
    self.format = self.ds.data_model
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 385, in ds
    return self._acquire()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 379, in _acquire
    with self._manager.acquire_context(needs_lock) as root:
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/contextlib.py", line 135, in __enter__
    return next(self.gen)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 197, in acquire_context
    file, cached = self._acquire_with_cache_info(needs_lock)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 215, in _acquire_with_cache_info
    file = self._opener(*self._args, **kwargs)
  File "src/netCDF4/_netCDF4.pyx", line 2449, in netCDF4._netCDF4.Dataset.__init__
  File "src/netCDF4/_netCDF4.pyx", line 2012, in netCDF4._netCDF4._ensure_nc_success
FileNotFoundError: [Errno 2] No such file or directory: '/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc'
###Â RUN DATE 2012-11-15 to 2012-11-22 ###
### RUN SIMU 0 to 5 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-15'
    - '2012-11-22'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-15'
    - '2012-11-22'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:52:01,853][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:52:02,506][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:52:02,519][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:52:02,530][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-11-15"', 'datamodule.test_slices.0._args_.1="2012-11-22"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
### RUN SIMU 5 to 10 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-15'
    - '2012-11-22'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-15'
    - '2012-11-22'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:52:13,266][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:52:13,925][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:52:13,937][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:52:13,948][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-11-15"', 'datamodule.test_slices.0._args_.1="2012-11-22"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 209, in _acquire_with_cache_info
    file = self._cache[self._key]
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/lru_cache.py", line 55, in __getitem__
    value = self._cache[key]
KeyError: [<class 'netCDF4._netCDF4.Dataset'>, ('/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc',), 'r', (('clobber', True), ('diskless', False), ('format', 'NETCDF4'), ('persist', False)), '20a64e56-c806-4f7f-a6d8-339aa4e4a2b7']

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<stdin>", line 4, in <module>
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/api.py", line 539, in open_dataset
    backend_ds = backend.open_dataset(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 572, in open_dataset
    store = NetCDF4DataStore.open(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 376, in open
    return cls(manager, group=group, mode=mode, lock=lock, autoclose=autoclose)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 323, in __init__
    self.format = self.ds.data_model
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 385, in ds
    return self._acquire()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 379, in _acquire
    with self._manager.acquire_context(needs_lock) as root:
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/contextlib.py", line 135, in __enter__
    return next(self.gen)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 197, in acquire_context
    file, cached = self._acquire_with_cache_info(needs_lock)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 215, in _acquire_with_cache_info
    file = self._opener(*self._args, **kwargs)
  File "src/netCDF4/_netCDF4.pyx", line 2449, in netCDF4._netCDF4.Dataset.__init__
  File "src/netCDF4/_netCDF4.pyx", line 2012, in netCDF4._netCDF4._ensure_nc_success
FileNotFoundError: [Errno 2] No such file or directory: '/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc'
###Â RUN DATE 2012-11-19 to 2012-11-26 ###
### RUN SIMU 0 to 5 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-19'
    - '2012-11-26'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-19'
    - '2012-11-26'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:52:26,168][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:52:26,728][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:52:26,740][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:52:26,751][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-11-19"', 'datamodule.test_slices.0._args_.1="2012-11-26"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
### RUN SIMU 5 to 10 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-19'
    - '2012-11-26'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-19'
    - '2012-11-26'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:52:37,196][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:52:37,736][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:52:37,750][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:52:37,764][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-11-19"', 'datamodule.test_slices.0._args_.1="2012-11-26"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 209, in _acquire_with_cache_info
    file = self._cache[self._key]
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/lru_cache.py", line 55, in __getitem__
    value = self._cache[key]
KeyError: [<class 'netCDF4._netCDF4.Dataset'>, ('/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc',), 'r', (('clobber', True), ('diskless', False), ('format', 'NETCDF4'), ('persist', False)), '50a7fb2a-6587-4c9c-86c1-8488ee9b5c4d']

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<stdin>", line 4, in <module>
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/api.py", line 539, in open_dataset
    backend_ds = backend.open_dataset(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 572, in open_dataset
    store = NetCDF4DataStore.open(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 376, in open
    return cls(manager, group=group, mode=mode, lock=lock, autoclose=autoclose)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 323, in __init__
    self.format = self.ds.data_model
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 385, in ds
    return self._acquire()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 379, in _acquire
    with self._manager.acquire_context(needs_lock) as root:
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/contextlib.py", line 135, in __enter__
    return next(self.gen)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 197, in acquire_context
    file, cached = self._acquire_with_cache_info(needs_lock)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 215, in _acquire_with_cache_info
    file = self._opener(*self._args, **kwargs)
  File "src/netCDF4/_netCDF4.pyx", line 2449, in netCDF4._netCDF4.Dataset.__init__
  File "src/netCDF4/_netCDF4.pyx", line 2012, in netCDF4._netCDF4._ensure_nc_success
FileNotFoundError: [Errno 2] No such file or directory: '/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc'
###Â RUN DATE 2012-11-23 to 2012-11-30 ###
### RUN SIMU 0 to 5 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-23'
    - '2012-11-30'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-23'
    - '2012-11-30'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:52:49,941][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:52:50,542][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:52:50,553][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:52:50,565][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-11-23"', 'datamodule.test_slices.0._args_.1="2012-11-30"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
### RUN SIMU 5 to 10 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-23'
    - '2012-11-30'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-23'
    - '2012-11-30'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:53:02,215][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:53:02,861][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:53:02,876][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:53:02,889][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-11-23"', 'datamodule.test_slices.0._args_.1="2012-11-30"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 209, in _acquire_with_cache_info
    file = self._cache[self._key]
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/lru_cache.py", line 55, in __getitem__
    value = self._cache[key]
KeyError: [<class 'netCDF4._netCDF4.Dataset'>, ('/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc',), 'r', (('clobber', True), ('diskless', False), ('format', 'NETCDF4'), ('persist', False)), '51d6457e-3574-4093-b600-b2e7b1d0d1fc']

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<stdin>", line 4, in <module>
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/api.py", line 539, in open_dataset
    backend_ds = backend.open_dataset(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 572, in open_dataset
    store = NetCDF4DataStore.open(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 376, in open
    return cls(manager, group=group, mode=mode, lock=lock, autoclose=autoclose)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 323, in __init__
    self.format = self.ds.data_model
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 385, in ds
    return self._acquire()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 379, in _acquire
    with self._manager.acquire_context(needs_lock) as root:
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/contextlib.py", line 135, in __enter__
    return next(self.gen)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 197, in acquire_context
    file, cached = self._acquire_with_cache_info(needs_lock)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 215, in _acquire_with_cache_info
    file = self._opener(*self._args, **kwargs)
  File "src/netCDF4/_netCDF4.pyx", line 2449, in netCDF4._netCDF4.Dataset.__init__
  File "src/netCDF4/_netCDF4.pyx", line 2012, in netCDF4._netCDF4._ensure_nc_success
FileNotFoundError: [Errno 2] No such file or directory: '/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc'
###Â RUN DATE 2012-11-27 to 2012-12-04 ###
### RUN SIMU 0 to 5 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-27'
    - '2012-12-04'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-27'
    - '2012-12-04'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:53:14,737][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:53:15,326][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:53:15,341][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:53:15,355][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-11-27"', 'datamodule.test_slices.0._args_.1="2012-12-04"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
### RUN SIMU 5 to 10 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-27'
    - '2012-12-04'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-27'
    - '2012-12-04'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:53:25,667][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:53:26,233][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:53:26,246][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:53:26,257][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
{'lat': 1, 'lon': 1, 'time': 4}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-11-27"', 'datamodule.test_slices.0._args_.1="2012-12-04"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 209, in _acquire_with_cache_info
    file = self._cache[self._key]
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/lru_cache.py", line 55, in __getitem__
    value = self._cache[key]
KeyError: [<class 'netCDF4._netCDF4.Dataset'>, ('/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc',), 'r', (('clobber', True), ('diskless', False), ('format', 'NETCDF4'), ('persist', False)), '8fbfac92-91a2-4f1e-b250-d10c623700ce']

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<stdin>", line 4, in <module>
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/api.py", line 539, in open_dataset
    backend_ds = backend.open_dataset(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 572, in open_dataset
    store = NetCDF4DataStore.open(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 376, in open
    return cls(manager, group=group, mode=mode, lock=lock, autoclose=autoclose)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 323, in __init__
    self.format = self.ds.data_model
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 385, in ds
    return self._acquire()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 379, in _acquire
    with self._manager.acquire_context(needs_lock) as root:
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/contextlib.py", line 135, in __enter__
    return next(self.gen)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 197, in acquire_context
    file, cached = self._acquire_with_cache_info(needs_lock)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 215, in _acquire_with_cache_info
    file = self._opener(*self._args, **kwargs)
  File "src/netCDF4/_netCDF4.pyx", line 2449, in netCDF4._netCDF4.Dataset.__init__
  File "src/netCDF4/_netCDF4.pyx", line 2012, in netCDF4._netCDF4._ensure_nc_success
FileNotFoundError: [Errno 2] No such file or directory: '/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc'
###Â RUN DATE 2012-12-01 to 2012-12-06 ###
### RUN SIMU 0 to 5 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-12-01'
    - '2012-12-06'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-12-01'
    - '2012-12-06'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:53:37,859][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:53:38,465][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:53:38,479][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:53:38,493][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 2}
{'lat': 1, 'lon': 1, 'time': 2}
{'lat': 1, 'lon': 1, 'time': 2}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-12-01"', 'datamodule.test_slices.0._args_.1="2012-12-06"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
### RUN SIMU 5 to 10 ###
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py:119: UserWarning: Future Hydra versions will no longer change working directory at job runtime by default.
See https://hydra.cc/docs/1.2/upgrades/1.1_to_1.2/changes_to_job_working_dir/ for more information.
  ret = run_job(
Global seed set to 0
file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-12-01'
    - '2012-12-06'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

file_paths:
  oi_path: /DATASET/data_xp_spde/oi/ssh_NATL60_swot_4nadir.nc
  obs_mask_path: /DATASET/data_xp_spde/data_new/dataset_nadir_0d_swot.nc
  gt_path: /DATASET/data_xp_spde/ref/NATL60-CJM165_GULFSTREAM_ssh_y2013.1y.nc
entrypoint:
  _target_: hydra_main.FourDVarNetHydraRunner.test
  ckpt_path: ../../model_oi_osse_spde_qg.ckpt
params:
  files_cfg:
    obs_mask_path: ${file_paths.obs_mask_path}
    obs_mask_var: ssh_mod
    gt_path: ${file_paths.gt_path}
    gt_var: ssh
    oi_path: ${file_paths.oi_path}
    oi_var: ssh_mod
    spde_params_path: null
  iter_update:
  - 0
  - 20
  - 40
  - 60
  - 100
  - 150
  - 800
  nb_grad_update:
  - 20
  - 20
  - 20
  - 20
  - 20
  - 20
  - 50
  - 50
  - 50
  lr_update:
  - 0.001
  - 0.0001
  - 0.001
  - 0.0001
  - 0.0001
  - 1.0e-05
  - 1.0e-05
  - 1.0e-06
  - 1.0e-07
  k_batch: 1
  n_grad: 15
  dT: 5
  dx: 1
  W: 100
  resize_factor: 2
  shapeData:
  - 5
  - 200
  - 200
  dW: 3
  dW2: 1
  sS: 4
  nbBlocks: 1
  Nbpatches: 1
  stochastic: false
  size_ensemble: 1
  animate: true
  supervised: true
  estim_parameters: true
  DimAE: 25
  dim_grad_solver: 70
  dropout: 0.25
  dropout_phi_r: 0.0
  alpha_proj: 0.5
  alpha_sr: 0.5
  alpha_lr: 0.5
  alpha_mse_ssh: 10.0
  alpha_mse_gssh: 1.0
  sigNoise: 0.0
  flagSWOTData: true
  rnd1: 0
  rnd2: 100
  dwscale: 1
  UsePriodicBoundary: false
  InterpFlag: false
  automatic_optimization: true
  ckpt_name: modelGP_{epoch:02d}-{val_loss:.2f}
  norm_obs: l2
  norm_prior: l2
  spde_type: adv_diff
  pow: 2
  test_domain:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  loss_type: ml_loss
  oi: true
  n_fourdvar_iter: 1
datamodule:
  dim_range:
    lat:
      _target_: builtins.slice
      _args_:
      - 33.0
      - 43.0
    lon:
      _target_: builtins.slice
      _args_:
      - -65.0
      - -55.0
  _target_: oi.xp_ssh.dataloading_osse.FourDVarNetDataModule
  slice_win:
    lat: 200
    lon: 200
    time: 5
  strides:
    lat: 200
    lon: 200
    time: 1
  train_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-10-01'
    - '2012-11-20'
  - _target_: builtins.slice
    _args_:
    - '2013-02-07'
    - '2013-09-10'
  test_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-12-01'
    - '2012-12-06'
  val_slices:
  - _target_: builtins.slice
    _args_:
    - '2012-11-30'
    - '2012-12-24'
  obs_mask_path: ${params.files_cfg.obs_mask_path}
  obs_mask_var: ${params.files_cfg.obs_mask_var}
  gt_path: ${params.files_cfg.gt_path}
  gt_var: ${params.files_cfg.gt_var}
  oi_path: ${params.files_cfg.oi_path}
  oi_var: ${params.files_cfg.oi_var}
  resize_factor: 2
  resolution: 1/20
  dl_kwargs:
    batch_size: 2
    num_workers: 2
lit_mod_cls: oi.xp_ssh.lit_model_spde.LitModel
xp_name: oi_osse_spde
seed: 0

Using current oi.xp_ssh.metrics
[2023-05-15 16:53:48,832][cartopy_userconfig][INFO] - Setting cartopy.config["pre_existing_data_dir"] to /homes/m19beauc/miniconda3/envs/4dvarnet/share/cartopy. Don't worry, this is probably intended behaviour to avoid failing downloads of geological data behind a firewall.
{'lat': 100, 'lon': 100, 'time': 5}
[2023-05-15 16:53:49,415][gribapi.bindings][INFO] - ecCodes library not found using name 'eccodes'.
[2023-05-15 16:53:49,427][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes.so'.
[2023-05-15 16:53:49,438][gribapi.bindings][INFO] - ecCodes library not found using name 'libeccodes'.
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
/homes/m19beauc/4dvarnet-core/hydra_main.py:295: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  main = hydra.main(config_path='hydra_config', config_name='main')(_main)
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 47}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 212}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 21}
{'lat': 1, 'lon': 1, 'time': 2}
{'lat': 1, 'lon': 1, 'time': 2}
{'lat': 1, 'lon': 1, 'time': 2}
get_model:  ../../model_oi_osse_spde_qg.ckpt
Error executing job with overrides: ['xp=mbeaucha/xp_spde/ssh/oi_osse_spde', 'file_paths=mee_a100_ssh', 'entrypoint=test', 'datamodule.test_slices.0._args_.0="2012-12-01"', 'datamodule.test_slices.0._args_.1="2012-12-06"', '+entrypoint.ckpt_path=../../model_oi_osse_spde_qg.ckpt']
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 92, in _call_target
    return _target_(*args, **kwargs)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 214, in test
    mod = _mod or self._get_model(ckpt_path=ckpt_path)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 119, in _get_model
    mod = self.lit_cls.load_from_checkpoint(ckpt_path,
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 139, in load_from_checkpoint
    return _load_from_checkpoint(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 188, in _load_from_checkpoint
    return _load_state(cls, checkpoint, strict=strict, **kwargs)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/pytorch_lightning/core/saving.py", line 247, in _load_state
    keys = obj.load_state_dict(checkpoint["state_dict"], strict=strict)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1604, in load_state_dict
    raise RuntimeError('Error(s) in loading state_dict for {}:\n\t{}'.format(
RuntimeError: Error(s) in loading state_dict for LitModel:
	size mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).
	size mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).
	size mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).
	size mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 298, in <module>
    main()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 223, in run_and_report
    raise ex
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/hydra.py", line 132, in run
    _ = ret.return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "/homes/m19beauc/4dvarnet-core/hydra_main.py", line 293, in _main
    call(cfg.entrypoint, self=runner)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 226, in instantiate
    return instantiate_node(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 347, in instantiate_node
    return _call_target(_target_, partial, args, kwargs, full_key)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/hydra/_internal/instantiate/_instantiate2.py", line 97, in _call_target
    raise InstantiationException(msg) from e
hydra.errors.InstantiationException: Error in call to target 'hydra_main.FourDVarNetHydraRunner.test':
RuntimeError('Error(s) in loading state_dict for LitModel:\n\tsize mismatch for model.phi_r.encoder.fc2.weight: copying a param with shape torch.Size([60, 512]) from checkpoint, the shape in current model is torch.Size([280, 512]).\n\tsize mismatch for model.phi_r.encoder.fc2.bias: copying a param with shape torch.Size([60]) from checkpoint, the shape in current model is torch.Size([280]).\n\tsize mismatch for model.model_Grad.convLayer.0.weight: copying a param with shape torch.Size([15, 70, 1, 1]) from checkpoint, the shape in current model is torch.Size([35, 70, 1, 1]).\n\tsize mismatch for model.model_Grad.lstm.Gates.weight: copying a param with shape torch.Size([280, 85, 3, 3]) from checkpoint, the shape in current model is torch.Size([280, 105, 3, 3]).')
full_key: entrypoint
/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/plugins.py:71: RuntimeWarning: Engine 'cfgrib' loading failed:
ecCodes library not found using ['eccodes', 'libeccodes.so', 'libeccodes']
  warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
Traceback (most recent call last):
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 209, in _acquire_with_cache_info
    file = self._cache[self._key]
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/lru_cache.py", line 55, in __getitem__
    value = self._cache[key]
KeyError: [<class 'netCDF4._netCDF4.Dataset'>, ('/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc',), 'r', (('clobber', True), ('diskless', False), ('format', 'NETCDF4'), ('persist', False)), '826fa708-2e1e-49b6-9e9b-265f23aa256f']

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<stdin>", line 4, in <module>
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/api.py", line 539, in open_dataset
    backend_ds = backend.open_dataset(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 572, in open_dataset
    store = NetCDF4DataStore.open(
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 376, in open
    return cls(manager, group=group, mode=mode, lock=lock, autoclose=autoclose)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 323, in __init__
    self.format = self.ds.data_model
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 385, in ds
    return self._acquire()
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/netCDF4_.py", line 379, in _acquire
    with self._manager.acquire_context(needs_lock) as root:
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/contextlib.py", line 135, in __enter__
    return next(self.gen)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 197, in acquire_context
    file, cached = self._acquire_with_cache_info(needs_lock)
  File "/homes/m19beauc/miniconda3/envs/4dvarnet/lib/python3.10/site-packages/xarray/backends/file_manager.py", line 215, in _acquire_with_cache_info
    file = self._opener(*self._args, **kwargs)
  File "src/netCDF4/_netCDF4.pyx", line 2449, in netCDF4._netCDF4.Dataset.__init__
  File "src/netCDF4/_netCDF4.pyx", line 2012, in netCDF4._netCDF4._ensure_nc_success
FileNotFoundError: [Errno 2] No such file or directory: '/homes/m19beauc/4dvarnet-core/dashboard/oi_osse_spde_qg/lightning_logs/version_11/maps.nc'
./launch_xp_spde_osse_qg.sh: ligne 57: avertissement : Â«Â here-documentÂ Â» Ã  la ligne 39 dÃ©limitÃ© par la fin du fichier (au lieu de Â«Â HEREDOCÂ Â»)
  File "<stdin>", line 7
    rm -rf tmp*.nc
           ^^^
SyntaxError: invalid syntax
